name: Validate PR Documentation

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  validate-pr-docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Extract and validate PR description checkboxes
        run: |
          echo "Extracting PR body..."
          BODY=$(jq -r '.pull_request.body // ""' "$GITHUB_EVENT_PATH")

          echo "---- PR Body ----"
          echo "$BODY"
          echo "-----------------"

          # Convert HTML entities to real characters just in case
          BODY=$(python3 -c "import html,sys; print(html.unescape(sys.argv[1]));" "$BODY")

          echo "Normalized body:"
          echo "$BODY"

          # Only pass if any one checkbox is actually checked ([x] or [X]) for Frontend / Backend / Both
          if echo "$BODY" | grep -Eiq '\[[xX]\][[:space:]]*(Frontend|Backend|Both)'; then
            echo "✅ Validation passed: Found a checked box for Frontend/Backend/Both."
            exit 0
          elif echo "$BODY" | grep -Eiq '(Frontend|Backend|Both)[[:space:]]*\[[xX]\]'; then
            echo "✅ Validation passed: Found checked box (label before checkbox)."
            exit 0
          else
            echo "❌ Validation failed: No checked box found for Frontend, Backend, or Both."
            exit 1
          fi
